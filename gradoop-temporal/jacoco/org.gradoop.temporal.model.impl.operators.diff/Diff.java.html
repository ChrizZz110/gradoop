<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Diff.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Gradoop Temporal</a> &gt; <a href="index.source.html" class="el_package">org.gradoop.temporal.model.impl.operators.diff</a> &gt; <span class="el_source">Diff.java</span></div><h1>Diff.java</h1><pre class="source lang-java linenums">/*
 * Copyright Â© 2014 - 2021 Leipzig University (Database Research Group)
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.gradoop.temporal.model.impl.operators.diff;

import org.apache.flink.api.java.DataSet;
import org.gradoop.common.model.impl.properties.PropertyValue;
import org.gradoop.flink.model.api.operators.UnaryBaseGraphToBaseGraphOperator;
import org.gradoop.temporal.model.api.TimeDimension;
import org.gradoop.temporal.model.api.functions.TemporalPredicate;
import org.gradoop.temporal.model.impl.TemporalGraph;
import org.gradoop.temporal.model.impl.operators.diff.functions.DiffPerElement;
import org.gradoop.temporal.model.impl.pojo.TemporalEdge;
import org.gradoop.temporal.model.impl.pojo.TemporalVertex;

import java.util.Objects;

/**
 * Calculates the difference between two snapshots of a graph by comparing the temporal attributes
 * of the graph elements.
 * &lt;p&gt;
 * The snapshots are extracted through two given temporal predicates. The result is a temporal graph
 * containing the union of both graph element sets. Each element gets a new property named
 * {@link Diff#PROPERTY_KEY} whose value will be a number indicating that an element is either
 * equal in both snapshots (0) or added (1) or removed (-1) in the second snapshot.
 * Elements not present in either snapshots will be discarded.
 * &lt;p&gt;
 * The resulting graph will not be verified, i.e. dangling edges could occur. Use the
 * {@link TemporalGraph#verify()} operator to validate the graph. The graph head is preserved.
 */
public class Diff implements UnaryBaseGraphToBaseGraphOperator&lt;TemporalGraph&gt; {
  /**
   * The property key used to store the diff result on each element.
   */
  public static final String PROPERTY_KEY = &quot;_diff&quot;;

  /**
   * The property value used to indicate that an element was added in the second snapshot.
   */
<span class="fc" id="L52">  public static final PropertyValue VALUE_ADDED = PropertyValue.create(1);</span>

  /**
   * The property value used to indicate that an element is equal in both snapshots.
   */
<span class="fc" id="L57">  public static final PropertyValue VALUE_EQUAL = PropertyValue.create(0);</span>

  /**
   * The property value used to indicate that an element was removed in the second snapshot.
   */
<span class="fc" id="L62">  public static final PropertyValue VALUE_REMOVED = PropertyValue.create(-1);</span>

  /**
   * The predicate used to determine the first snapshot.
   */
  private final TemporalPredicate firstPredicate;

  /**
   * The predicate used to determine the second snapshot.
   */
  private final TemporalPredicate secondPredicate;

  /**
   * Specifies the time dimension that will be considered by the operator.
   */
  private TimeDimension dimension;

  /**
   * Create an instance of the TPGM diff operator, setting the two predicates used to determine the snapshots.
   * By default, valid times will be used by the predicate. To use transaction times, use
   * {@link Diff#Diff(TemporalPredicate, TemporalPredicate, TimeDimension)} instead.
   *
   * @param firstPredicate  The predicate used for the first snapshot.
   * @param secondPredicate The predicate used for the second snapshot.
   */
  public Diff(TemporalPredicate firstPredicate, TemporalPredicate secondPredicate) {
<span class="nc" id="L88">    this(firstPredicate, secondPredicate, TimeDimension.VALID_TIME);</span>
<span class="nc" id="L89">  }</span>
  /**
   * Create an instance of the TPGM diff operator, setting the two predicates used to determine the snapshots.
   *
   * @param firstPredicate The predicate used for the first snapshot.
   * @param secondPredicate The predicate used for the second snapshot.
   * @param dimension The time dimension that will be used.
   */
<span class="fc" id="L97">  public Diff(TemporalPredicate firstPredicate, TemporalPredicate secondPredicate, TimeDimension dimension) {</span>
<span class="fc" id="L98">    this.firstPredicate = Objects.requireNonNull(firstPredicate, &quot;No first predicate given.&quot;);</span>
<span class="fc" id="L99">    this.secondPredicate = Objects.requireNonNull(secondPredicate, &quot;No second predicate given.&quot;);</span>
<span class="fc" id="L100">    this.dimension = Objects.requireNonNull(dimension, &quot;No time dimension given.&quot;);</span>
<span class="fc" id="L101">  }</span>

  @Override
  public TemporalGraph execute(TemporalGraph graph) {
<span class="fc" id="L105">    DataSet&lt;TemporalVertex&gt; transformedVertices = graph.getVertices()</span>
<span class="fc" id="L106">      .flatMap(new DiffPerElement&lt;&gt;(firstPredicate, secondPredicate, dimension));</span>
<span class="fc" id="L107">    DataSet&lt;TemporalEdge&gt; transformedEdges = graph.getEdges()</span>
<span class="fc" id="L108">      .flatMap(new DiffPerElement&lt;&gt;(firstPredicate, secondPredicate, dimension));</span>
<span class="fc" id="L109">    return graph.getFactory().fromDataSets(graph.getGraphHead(), transformedVertices, transformedEdges);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.1.201803210924</span></div></body></html>